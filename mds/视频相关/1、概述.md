## 视频流相关概念

### 常见视频协议

> RTMP RTSP HLS HTTP

**RTMP - Real Time Messaging Protocol**
流媒体协议、Adobe私有、支持flv和f4v格式、一个TCP通道传输命令和数据
M 为 stream

**RTSP - Real Time Streaming Protocol**
流媒体协议、公有协议、支持ts和mp4格式、2-3个TCP通道分别传输命令和数据


**HLS - HTTP Live Streaming**
流媒体协议、公有协议、支持ts和mp4格式、2-3个TCP通道分别传输命令和数据

**HTTP**
非流媒体协议、公有协议、没有特定的传输流、一个TCP通道分别传输命令和数据

#### 一、RTMP

RTMP协议中基本的数据单元称为消息（Message）。当RTMP协议在互联网中传输数据的时候，消息会被拆分成更小的单元，称为块（Chunk）。

**交互过程**
播放一个RTMP协议的流媒体需要经过以下几个步骤：握手，建立连接，建立流，播放。


#### 二、RTSP

RTSP本身并不用于转送媒体流数据。媒体数据的传送可通过RTP/RTCP等协议来完成

**交互过程**

1. 客户端连接到流服务器，查询服务器可用方法
2. 发送一个RTSP描述命令（DESCRIBE），流服务器通过一个SDP描述来进行反馈，反馈信息包括流数量、媒体类型等信息。
3. 客户端再分析该SDP描述，并为会话中的每一个流发送一个RTSP建立命令(SETUP)，RTSP建立命令告诉服务器客户端用于接收媒体数据的端口。
4. 流媒体连接建立完成后，客户端发送一个播放命令(PLAY)，服务器就开始在传送媒体流（RTP包）到客户端。在播放过程中客户端还可以向服务器发送命令来控制快进、快退和暂停等。
5. 最后，客户端可发送一个终止命令(TERADOWN)来结束流媒体会话。

#### 三、HLS

HTTP Live Streaming（缩写是HLS）是一个由苹果公司提出的基于HTTP的流媒体网络传输协议。是苹果公司QuickTime X和iPhone软件系统的一部分。它的工作原理是把整个流分成一个个小的基于HTTP的文件来下载，每次只下载一些。当媒体流正在播放时，客户端可以选择从许多不同的备用源中以不同的速率下载同样的资源，允许流媒体会话适应不同的数据速率。在开始一个流媒体会话时，客户端会下载一个包含元数据的extended M3U (m3u8)playlist文件，用于寻找可用的媒体流。
HLS只请求基本的HTTP报文，与实时传输协议（RTP)不同，HLS可以穿过任何允许HTTP数据通过的防火墙或者代理服务器。它也很容易使用内容分发网络来传输媒体流。

**格式**

视频的封装格式是TS。
视频的编码格式为H264,音频编码格式为MP3、AAC或者AC-3。
除了TS视频文件本身，还定义了用来控制播放的m3u8文件（文本文件）。

**优点**

为了解决RTMP协议存在的一些问题。比如RTMP协议不使用标准的HTTP接口传输数据，所以在一些特殊的网络环境下可能被防火墙屏蔽掉。但是HLS由于使用的HTTP协议传输数据，不会遇到被防火墙屏蔽的情况。

**播放方式**

客户端播放HLS视频流的逻辑其实非常简单，先下载一级Index file，它里面记录了二级索引文件（Alternate-A、Alternate-B、Alternate-C）的地址，然后客户端再去下载二级索引文件，二级索引文件中又记录了TS文件的下载地址，这样客户端就可以按顺序下载TS视频文件并连续播放。

**点播和直播**

点播VOD 特点就是当前时间点可以获取到所有index文件和ts文件，二级index文件中记录了所有ts文件的地址。这种模式允许客户端访问全部内容。上面的例子中就是一个点播模式下的m3u8的结构。

Live 模式就是实时生成M3u8和ts文件。它的索引文件一直处于动态变化的，播放的时候需要不断下载二级index文件，以获得最新生成的ts文件播放视频。如果一个二级index文件的末尾没有#EXT-X-ENDLIST标志，说明它是一个Live视频流。


引用：
 [常见视频协议](http://www.jianshu.com/p/426425cad08a "常见视频协议")

#### 四、HTTP


